# Projeto de Deploy com Linux e AWS

Este projeto envolve a configura√ß√£o de uma inst√¢ncia EC2 na AWS com Nginx, automa√ß√£o de monitoramento e notifica√ß√µes via Telegram.

## üìå √çndice
1. [Cria√ß√£o da VPC](#cria√ß√£o-da-vpc)
2. [Configura√ß√£o do Security Group](#configura√ß√£o-do-security-group)
3. [Cria√ß√£o da Inst√¢ncia](#cria√ß√£o-da-inst√¢ncia)
4. [Configura√ß√£o da Chave de Acesso](#configura√ß√£o-da-chave-de-acesso)
5. [Conex√£o √† Inst√¢ncia](#conex√£o-√†-inst√¢ncia)
6. [Instala√ß√£o de Depend√™ncias](#instala√ß√£o-de-depend√™ncias)
7. [Ativa√ß√£o do Nginx](#ativa√ß√£o-do-nginx)
8. [Modifica√ß√£o da P√°gina Web](#modifica√ß√£o-da-p√°gina-web)
9. [Configura√ß√£o do SystemD](#configura√ß√£o-do-systemd)
10. [Cria√ß√£o do Bot do Telegram](#cria√ß√£o-do-bot-do-telegram)
11. [Cria√ß√£o do Script de Monitoramento](#cria√ß√£o-do-script-de-monitoramento)
12. [Logs e Monitoramento](#logs-e-monitoramento)

## 1Ô∏è‚É£ Cria√ß√£o da VPC
Criar uma VPC com tr√™s sub-redes separadas.

## 2Ô∏è‚É£ Configura√ß√£o do Security Group
- Criar um Security Group com tr√™s parti√ß√µes.
- Liberar portas HTTP e SSH privadas apenas para o seu IP.
- Ap√≥s a aplica√ß√£o estar pronta, liberar apenas HTTP.

## 3Ô∏è‚É£ Cria√ß√£o da Inst√¢ncia
- Criar um par de chaves para acesso.
- Habilitar IP p√∫blico.
- Selecionar o Security Group correto.
- Escolher a sub-rede p√∫blica da VPC.

## 4Ô∏è‚É£ Configura√ß√£o da Chave de Acesso
Mover a chave para `/home/marcelomanara/.ssh/` e definir permiss√µes:
```sh
chmod 400 /home/marcelomanara/.ssh/sua-chave.pem
```

## 5Ô∏è‚É£ Conex√£o √† Inst√¢ncia
Conectar via SSH usando:
```sh
ssh -i /home/marcelomanara/.ssh/sua-chave.pem ubuntu@IP_DA_INST√ÇNCIA
```

## 6Ô∏è‚É£ Instala√ß√£o de Depend√™ncias
```sh
sudo apt-get update -y
sudo apt-get install iptables nginx -y
```

## 7Ô∏è‚É£ Ativa√ß√£o do Nginx
```sh
sudo systemctl start nginx
sudo systemctl enable nginx
```
Acesse via IP p√∫blico da inst√¢ncia no navegador.

## 8Ô∏è‚É£ Modifica√ß√£o da P√°gina Web
O diret√≥rio padr√£o para arquivos da web no Ubuntu √©:
```sh
cd /var/www/html
```

## 9Ô∏è‚É£ Configura√ß√£o do SystemD
Editar o servi√ßo do Nginx para garantir reinicializa√ß√£o autom√°tica:
```sh
sudo nano /usr/lib/systemd/system/nginx.service
```
Adicionar as linhas em `[Service]`:
```
Restart=always
RestartSec=7s
```
Recarregar e reiniciar o servi√ßo:
```sh
sudo systemctl daemon-reload
sudo systemctl restart nginx
```
Testar a configura√ß√£o:
```sh
sudo systemctl status nginx
sudo pkill -9 nginx
sudo systemctl status nginx
```

## üîü Cria√ß√£o do Bot do Telegram
Criar um bot via @BotFather e obter o token.

Para obter o chat ID:
```sh
https://api.telegram.org/bot<TOKEN>/getUpdates
```
O ID estar√° no JSON retornado:
```json
"chat":{"id":7596659083,"first_name":"Marcelo","last_name":"Manara","type":"private"}
```

## 1Ô∏è‚É£1Ô∏è‚É£ Cria√ß√£o do Script de Monitoramento
Criar script Python para monitoramento e notifica√ß√µes em `/usr/local/bin/telegram_notify.py`.

Criar script Bash para monitoramento em `/usr/local/bin/monitor_nginx.sh` e conceder permiss√£o de execu√ß√£o:
```sh
sudo chmod +x /usr/local/bin/monitor_nginx.sh
```
Criar servi√ßo SystemD:
```sh
sudo nano /etc/systemd/system/monitor_nginx.service
```
Adicionar:
```
[Unit]
Description=Monitoramento do Nginx
After=network.target

[Service]
ExecStart=/usr/local/bin/monitor_nginx.sh
Restart=always
User=root

[Install]
WantedBy=multi-user.target
```
Habilitar e iniciar o servi√ßo:
```sh
sudo systemctl enable monitor_nginx
sudo systemctl start monitor_nginx
sudo systemctl status monitor_nginx
```
Para remover:
```sh
sudo systemctl disable monitor_nginx
sudo rm /etc/systemd/system/monitor_nginx.service
sudo rm /usr/local/bin/monitor_nginx.sh
```

## 1Ô∏è‚É£2Ô∏è‚É£ Logs e Monitoramento
Para armazenar logs quando o site cair:
```sh
echo "$(date '+%Y-%m-%d %H:%M:%S') - Site caiu" >> /var/log/nginx_monitoramento.log
```
Verificar logs do servi√ßo:
```sh
sudo journalctl -u monitor_nginx --since "1 hour ago"
```
Verificar logs do Nginx:
```sh
tail -f /var/log/nginx/access.log
```

